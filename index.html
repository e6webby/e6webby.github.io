<html><head><base href=".">
<title>e6webby - e621 web client</title>
<link rel="icon" type="image/x-icon" href="https://e621.net/favicon.ico">
<style>
body{
    margin: 0;
    padding: 40px;
    background: #1a1a1a; 
    color: #f0f0f0;
    font-family: 'Segoe UI', system-ui, sans-serif;
    line-height: 1.8
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
    gap:20px;
    margin:20px 0
}
.grid-item{
    width:100%;
    height:400px;
    position:relative;
    border-radius:12px;
    background: #2a2a2a;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    overflow:hidden;
    cursor:pointer;
    transition:transform 0.3s ease, box-shadow 0.3s ease
}
.grid-item:hover{
    transform:translateY(-5px);
    box-shadow: 0 8px 12px rgba(0,0,0,0.3)
}
.grid-item img, .grid-item video{
    width:100%;
    height:100%;
    object-fit:cover
}
.video-indicator{
    position:absolute;
    top:10px;
    right:10px;
    background:rgba(0,0,0,0.7);
    padding:5px 10px;
    border-radius:4px
}

/* Enhanced search styles */
#filters {
    margin: 20px 0;
    position: relative;
    max-width: 800px;
}

.search-container {
    position: relative;
    display: inline-block;
    width: 60%;
}

#tags {
    width: 100%;
    padding: 12px 20px;
    font-size: 16px;
    border: 2px solid #444;
    background: #2a2a2a;
    color: #fff;
    border-radius: 12px;
    transition: all 0.3s ease;
}

#tags:focus {
    outline: none;
    border-color: #0066cc;
    box-shadow: 0 0 0 3px rgba(0,102,204,0.2);
}

.tag-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: #333;
    border: 1px solid #444;
    border-radius: 0 0 8px 8px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
}

.tag-suggestion {
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.tag-suggestion:hover {
    background: #444;
}

.tag-count {
    font-size: 0.8em;
    color: #999;
    background: #2a2a2a;
    padding: 2px 6px;
    border-radius: 4px;
}

select {
    padding: 12px 20px;
    margin: 0 10px;
    background: #2a2a2a;
    color: #fff;
    border: 2px solid #444;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
}

button {
    padding: 12px 20px;
    background: #2a2a2a;
    color: #fff;
    border: 2px solid #444;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
}

button:hover {
    background: #0052a3;
}

.warning {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(8px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    margin: 0;
    padding: 40px;
    text-align: center;
}

.warning-buttons {
    margin-top: 20px;
}

.warning-btn {
    padding: 12px 24px;
    margin: 0 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 18px;
    transition: 0.3s;
}

.warning-btn.yes {
    background: #4CAF50;
    color: white;
}

.warning-btn.no {
    background: #f44336;
    color: white;
}

.warning-btn:hover {
    opacity: 0.9;
}

/* Mobile responsive styles */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
    }

    .grid-item {
        height: 300px;
    }

    #filters {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .search-container {
        width: 100%;
    }

    select {
        margin: 0;
        width: 100%;
    }

    button {
        width: 100%;
    }

    .modal-content {
        flex-direction: column;
        margin: 0;
        max-width: 100%;
        height: 100vh;
    }

    .modal-media {
        flex: 1;
    }

    .modal-details {
        flex: 1;
        max-height: 50vh;
    }
}

/* Modal styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 1000;
}

.modal-content {
    display: flex;
    max-width: 90%;
    max-height: 90vh;
    margin: 2% auto;
    background: #2a2a2a;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    border-radius: 16px;
    overflow: hidden;
}

.modal-media {
    position: relative;
    flex: 2;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.modal-media img, .modal-media video {
    max-width: 100%;
    max-height: 80vh;
    height: auto;
    object-fit: contain;
}

.modal-details {
    flex: 1;
    background: #333;
    padding: 30px;
    overflow-y: auto;
}

.tag {
    display: inline-block;
    background: #3a3a3a;
    color: #fff;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    margin: 4px;
    border: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    transition: background 0.2s;
}

.tag:hover {
    background: #4a4a4a;
    border-color: rgba(255,255,255,0.2);
}

.close-modal {
    position: absolute;
    top: 10px;
    right: 20px;
    color: white;
    font-size: 30px;
    cursor: pointer;
}

.quote {
    background: #333;
    border-left: 4px solid #0066cc;
    padding: 10px;
    margin: 10px 0;
}

.download-btn {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0, 102, 204, 0.8);
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.3s;
}

.download-btn:hover {
    background: rgba(0, 82, 163, 0.9);
}

.logo {
    width: 200px;
    height: 100px;
    margin: 20px auto;
    display: block;
}

.theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px;
    border-radius: 50%;
    background: #444;
    border: none;
    cursor: pointer;
    z-index: 100;
}

.dark-theme {
    --bg-color: #222;
    --text-color: #fff;
    --accent-color: #0066cc;
}

.light-theme {
    --bg-color: #f0f0f0;
    --text-color: #333;
    --accent-color: #0052a3;
}

/* Add responsive styles */
.filters-expanded {
    margin-top: 10px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
}

.filter-option {
    padding: 8px;
    background: #444;
    border-radius: 4px;
    cursor: pointer;
}

.filter-option.active {
    background: #0066cc;
}

.image-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.7);
    padding: 10px;
    opacity: 0;
    transition: opacity 0.3s;
}

.grid-item:hover .image-overlay {
    opacity: 1;
}

.share-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 102, 204, 0.8);
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.remove-favorite {
    position: absolute;
    right: 10px;
    top: 10px;
    color: #ff4444;
    cursor: pointer;
}

.favorite-item {
    margin: 10px 0;
    padding: 10px;
    background: #444;
    border-radius: 8px;
    position: relative;
}
</style>
</head>
<body>
<div class="warning">
    <h2>Content Notice</h2>
    <p>This viewer displays pornographic content from e621; for which you have to be 18 or older for. Would you like to proceed?</p>
    <div class="warning-buttons">
        <button class="warning-btn yes" onclick="proceedToSite()">Yes</button>
        <button class="warning-btn no" onclick="redirectToGoogle()">No</button>
    </div>
</div>
<svg class="logo" viewBox="0 0 200 100">
    <defs>
        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#0066cc;stop-opacity:1"/>
            <stop offset="100%" style="stop-color:#ff4081;stop-opacity:1"/>
        </linearGradient>
    </defs>
    <path d="M20,50 Q50,20 80,50 T140,50" stroke="url(#grad)" stroke-width="8" fill="none"/>
    <text x="50" y="80" fill="#fff" font-size="24" font-weight="bold">e6webby</text>
</svg>
<div id="filters">
    <div class="search-container">
        <input type="text" id="tags" placeholder="Enter tags (e.g. dog, cat)" autocomplete="off">
        <div class="tag-suggestions" id="tagSuggestions"></div>
    </div>
    <select id="sort">
        <option value="score">Sort by Score</option>
        <option value="date">Sort by Date</option>
        <option value="favorites">Sort by Favorites</option>
        <option value="random">Random</option>
    </select>
    <button onclick="searchMedia(true)">Search</button>
</div>
<button class="theme-toggle" id="themeToggle">&#x1f319;</button>
<div id="grid" class="grid"></div>
<div id="loading" style="display: none; text-align: center; padding: 20px;">
    Loading...
</div>

<!-- Modal -->
<div id="modal" class="modal">
    <span class="close-modal" onclick="closeModal()">&#xd7;</span>
    <div class="modal-content">
        <div class="modal-media" id="modal-media-container">
            <!-- Media content will be inserted here -->
        </div>
        <div class="modal-details">
            <h2>Details</h2>
            <div id="modal-description"></div>
            <h3>Tags</h3>
            <div id="modal-tags"></div>
        </div>
    </div>
</div>

<script>const API_URL = 'https://e621.net/posts.json';
const TAGS_API_URL = 'https://e621.net/tags.json';
let page = 1;
let loading = false;
let currentPosts = [];
let lastSearchTags = '';
let tagSearchTimeout = null;
let favorites = [];
let viewHistory = [];
let viewStats = {};
let currentTheme = localStorage.getItem('theme') || 'dark';
const filterOptions = ['score>100', 'score>500', 'score>1000', 'favcount>100', 'favcount>500', 'favcount>1000', 'width>1920', 'height>1080', 'order:random', 'order:score', 'order:favcount'];
const tagCategories = {
  'general': 'Common Tags',
  'species': 'Species & Creatures',
  'character': 'Characters',
  'copyright': 'Source Material',
  'artist': 'Artists',
  'meta': 'Metadata',
  'lore': 'Story Elements'
};
const AUTH_HEADER = 'Basic ' + btoa('e6-webclient:e621-safe-client');
function parseDescription(description) {
  if (!description) return 'No description available';
  description = description.replace(/\[quote\](.*?)\[\/quote\]/g, '<div class="quote">$1</div>');
  return description;
}
function createMediaElement(post) {
  const isVideo = post.file.ext === 'webm' || post.file.ext === 'mp4';
  const element = isVideo ? document.createElement('video') : document.createElement('img');
  if (isVideo) {
    element.controls = true;
    element.loop = true;
    element.preload = 'metadata';
    element.src = post.file.ext === 'webm' ? post.file.url.replace('.webm', '.mp4') : post.file.url;
  } else {
    element.src = post.file.url;
  }
  element.alt = post.description || `Safe e621 ${isVideo ? 'video' : 'image'}`;
  return element;
}
async function searchTags(query) {
  if (!query) {
    document.getElementById('tagSuggestions').style.display = 'none';
    return;
  }
  try {
    const response = await fetch(`${TAGS_API_URL}?search[name_matches]=${encodeURIComponent(query + '*')}&limit=10&search[order]=count`, {
      headers: {
        'User-Agent': 'SafeViewer/1.0',
        'Authorization': AUTH_HEADER
      }
    });
    if (!response.ok) throw new Error('Network response was not ok');
    const tags = await response.json();
    const suggestionsDiv = document.getElementById('tagSuggestions');
    suggestionsDiv.innerHTML = '';
    if (tags.length > 0) {
      tags.forEach(tag => {
        const div = document.createElement('div');
        div.className = 'tag-suggestion';
        div.innerHTML = `
                    <span>${tag.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                    <span class="tag-count">${tag.post_count.toLocaleString()}</span>
                `;
        div.onclick = () => {
          document.getElementById('tags').value = tag.name;
          suggestionsDiv.style.display = 'none';
          searchMedia(true);
        };
        suggestionsDiv.appendChild(div);
      });
      suggestionsDiv.style.display = 'block';
    } else {
      suggestionsDiv.style.display = 'none';
    }
  } catch (error) {
    console.error('Error fetching tag suggestions:', error);
  }
}
document.getElementById('tags').addEventListener('input', e => {
  clearTimeout(tagSearchTimeout);
  tagSearchTimeout = setTimeout(() => {
    searchTags(e.target.value);
  }, 300);
});
document.addEventListener('click', e => {
  const suggestionsDiv = document.getElementById('tagSuggestions');
  const searchInput = document.getElementById('tags');
  if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
    suggestionsDiv.style.display = 'none';
  }
});
function openModal(post) {
  const modal = document.getElementById('modal');
  const mediaContainer = document.getElementById('modal-media-container');
  const modalDesc = document.getElementById('modal-description');
  const modalTags = document.getElementById('modal-tags');
  mediaContainer.innerHTML = '';
  const downloadBtn = document.createElement('a');
  downloadBtn.className = 'download-btn';
  downloadBtn.href = post.file.ext === 'webm' ? post.file.url.replace('.webm', '.mp4') : post.file.url;
  downloadBtn.target = '_blank';
  downloadBtn.textContent = 'Download';
  mediaContainer.appendChild(downloadBtn);
  const mediaElement = createMediaElement(post);
  mediaContainer.appendChild(mediaElement);
  if (mediaElement.tagName === 'VIDEO') {
    mediaElement.play().catch(e => console.log('Auto-play prevented:', e));
  }
  modalDesc.innerHTML = parseDescription(post.description);
  modalTags.innerHTML = '';
  Object.entries(post.tags).forEach(([category, tags]) => {
    if (tags.length > 0) {
      const categoryHeader = document.createElement('h4');
      categoryHeader.textContent = tagCategories[category] || category;
      categoryHeader.style.color = '#0066cc';
      categoryHeader.style.marginTop = '20px';
      modalTags.appendChild(categoryHeader);
      const tagContainer = document.createElement('div');
      tagContainer.style.display = 'flex';
      tagContainer.style.flexWrap = 'wrap';
      tagContainer.style.gap = '8px';
      tags.forEach(tag => {
        const tagSpan = document.createElement('span');
        tagSpan.className = 'tag';
        tagSpan.textContent = tag.replace(/_/g, ' ');
        tagSpan.onclick = e => {
          e.stopPropagation();
          document.getElementById('tags').value = tag;
          closeModal();
          searchMedia(true);
        };
        tagContainer.appendChild(tagSpan);
      });
      modalTags.appendChild(tagContainer);
    }
  });
  modal.style.display = 'block';
  const shareButton = document.createElement('button');
  shareButton.className = 'share-btn';
  shareButton.textContent = 'Share';
  shareButton.onclick = e => {
    e.stopPropagation();
    sharePost(post);
  };
  mediaContainer.appendChild(shareButton);
}
function closeModal() {
  const modal = document.getElementById('modal');
  const mediaContainer = document.getElementById('modal-media-container');
  const videoElement = mediaContainer.querySelector('video');
  if (videoElement) {
    videoElement.pause();
  }
  modal.style.display = 'none';
}
async function searchMedia(newSearch = false) {
  if (loading) return;
  const tags = document.getElementById('tags').value;
  const sort = document.getElementById('sort').value;
  const grid = document.getElementById('grid');
  const loadingDiv = document.getElementById('loading');
  if (newSearch) {
    grid.innerHTML = '';
    page = 1;
    lastSearchTags = tags;
  }
  loading = true;
  loadingDiv.style.display = 'block';
  try {
    const sortMap = {
      'score': 'order:score',
      'date': 'order:date',
      'favorites': 'order:favcount',
      'random': 'order:random'
    };
    const sortParam = sortMap[sort];
    const searchTags = `${lastSearchTags} ${sortParam} `;
    const response = await fetch(`${API_URL}?tags=${encodeURIComponent(searchTags)}&limit=20&page=${page}`, {
      headers: {
        'User-Agent': 'SafeViewer/1.0'
      }
    });
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    currentPosts = data.posts;
    data.posts.forEach(post => {
      if (!post.flags.deleted) {
        const gridItem = document.createElement('div');
        gridItem.className = 'grid-item';
        const isVideo = post.file.ext === 'webm' || post.file.ext === 'mp4';
        if (isVideo) {
          const thumb = document.createElement('img');
          thumb.src = post.sample.url;
          thumb.alt = 'Video thumbnail';
          const indicator = document.createElement('div');
          indicator.className = 'video-indicator';
          indicator.textContent = '▶ Video';
          gridItem.appendChild(thumb);
          gridItem.appendChild(indicator);
        } else {
          const img = document.createElement('img');
          img.src = post.sample.url;
          img.alt = post.description || ' e621 image';
          gridItem.appendChild(img);
        }
        const downloadBtn = document.createElement('a');
        downloadBtn.className = 'download-btn';
        downloadBtn.href = post.file.ext === 'webm' ? post.file.url.replace('.webm', '.mp4') : post.file.url;
        downloadBtn.target = '_blank';
        downloadBtn.textContent = 'Download';
        gridItem.appendChild(downloadBtn);
        gridItem.onclick = () => openModal(post);
        grid.appendChild(gridItem);
      }
    });
  } catch (error) {
    console.error('Error fetching media:', error);
    grid.innerHTML = '<p>Error loading content. Please try again later.</p>';
  } finally {
    loading = false;
    loadingDiv.style.display = 'none';
  }
}
window.onclick = function (event) {
  const modal = document.getElementById('modal');
  if (event.target === modal) {
    closeModal();
  }
};
window.addEventListener('scroll', () => {
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
    page++;
    searchMedia();
  }
});
document.addEventListener('keydown', event => {
  if (event.key === 'Escape') {
    closeModal();
  }
});
function proceedToSite() {
  document.querySelector('.warning').style.display = 'none';
  searchMedia(true);
}
function redirectToGoogle() {
  window.location.href = 'https://www.youtube.com/watch?v=bFcG-q4eTSY';
}
function toggleTheme() {
  currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.body.className = `${currentTheme}-theme`;
  document.getElementById('themeToggle').textContent = currentTheme === 'dark' ? '🌙' : '☀️';
  localStorage.setItem('theme', currentTheme);
}
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('themeToggle').onclick = toggleTheme;
  document.body.className = `${currentTheme}-theme`;
});</script>
</body>
</html>
